# 非偶极子磁场各要素全球分布及时间变化的计算方法论

本文旨在综合目录中若干论文的思路（如“1900–2000年非偶极子磁场的全球变化”安振昌等、行星尺度地磁异常长期变化、IGRF12/IGRF13 说明文等），整理出一套可直接实现的、统一的非偶极子磁场各要素全球分布及时间变化的计算方法。为保证在普通 Markdown 预览环境下公式显示正确，下面所有公式尽量使用普通文本或代码形式书写，而不依赖 LaTeX 渲染。

## 1 研究目标与基本概念

- 目标 1：给定某一时期的主磁场模型（IGRF 各代），计算地球表面非偶极子磁场各要素（X, Y, Z, H, D, I, F）的全球分布。
- 目标 2：利用多历元模型（例如 1900–2020 年，每 5 年一历元），刻画非偶极子磁场各要素的长期变化，重点分析行星尺度磁异常（东亚、大洋洲、南大西洋、非洲、北美等）的强度、面积、中心位置及其演化（包括西向漂移）。
- 目标 3：在上述基础上，给出可实现的数值计算流程，便于在 MATLAB / Python 等环境中复现。

这里的“非偶极子磁场”指去除中心偶极子场之后剩余的主磁场部分，即主场中由二阶及以上球谐项（l ≥ 2）构成的部分。多数论文均采用这种定义。

## 2 数据与模型：IGRF 与高斯系数

1. 模型选择
   - 全球主磁场采用国际地磁参考场 IGRF 的各代模型：
     - 1900–2000 年：早期工作通常使用 IGRF-7 或 IGRF-8。
     - 1900–2020 年或更近：使用 IGRF-13，可覆盖 1900–2025。
   - 模型提供内容：
     - 内源场的高斯系数 `g_l^m(t)`、`h_l^m(t)`（l 为阶数，m 为阶次），给出主磁场的球谐展开。
     - 对最近若干年的时间导数 `ġ_l^m`、`ḣ_l^m`（长期变化系数），用于内插任意时刻的主场。

2. 地球参考半径
   - IGRF 采用的参考球半径：`a = 6371.2 km`。
   - 计算地表场时取 `r = a`；若需求近地空间（如卫星高度）则取 `r = a + h`，方法相同。

3. 时间处理
   - 历元：IGRF 每 5 年给出一次完整高斯系数（1900.0, 1905.0, …, 2020.0 等）。
   - 任意年份 t 的系数：
     - 若 t 落在相邻两个正式历元之间，使用 IGRF 给出的线性内插或长期变化模型。
     - 对于长期变化研究，为保持与经典工作可比，通常直接按 5 a（年）步长取整历元，避免过多内插。

## 3 球谐展开与偶极/非偶极分解

### 3.1 标量势与主磁场

在地心球坐标系 `(r, θ, φ)` 中（r 为半径，θ 为余纬度=从北极起算的极角，φ 为地理经度），内源主磁场的标量势写为：

`V(r,θ,φ,t) = a Σ_{l=1}^L (a/r)^{l+1} Σ_{m=0}^l [ g_l^m(t) cos(mφ) + h_l^m(t) sin(mφ) ] P_l^m(cosθ)`

其中：

- `P_l^m` 为 Schmidt 半正规化缔合勒让德函数。
- `L` 为展开的最大阶数，IGRF-13 为 `L = 13`。

磁感应强度矢量 `B` 由标量势梯度给出：

`B = -∇V = (B_r, B_θ, B_φ)`

具体分量为：

- `B_r = -∂V/∂r`
- `B_θ = -(1/r) ∂V/∂θ`
- `B_φ = -(1/(r sinθ)) ∂V/∂φ`

代入 V 并整理，可得标准 IGRF 代码中使用的分量表达式，这里不再逐项展开，只需在计算实现中调用对应的公式或官方程序。

### 3.2 偶极场与非偶极场的严格分离

1. 偶极场定义
   - 偶极场由 `l = 1` 的所有球谐项组成，包括：
     - `g_1^0, g_1^1, h_1^1`。
   - 将 V 中 `l = 1` 的部分单独提取，记为 `V^(1)`：

`V^(1)(r,θ,φ,t) = a (a/r)^2 Σ_{m=0}^1 [ g_1^m(t) cos(mφ) + h_1^m(t) sin(mφ) ] P_1^m(cosθ)`

   - 对 `V^(1)` 求梯度，即得偶极子磁场分量：

`B^(1) = (B_r^(1), B_θ^(1), B_φ^(1)) = -∇V^(1)`

2. 非偶极场定义
   - 非偶极场由所有 `l ≥ 2` 的项组成，对应的标量势：

`V^(nd)(r,θ,φ,t) = a Σ_{l=2}^L (a/r)^{l+1} Σ_{m=0}^l [ g_l^m(t) cos(mφ) + h_l^m(t) sin(mφ) ] P_l^m(cosθ)`

   - 非偶极子磁场分量：

`B^(nd) = (B_r^(nd), B_θ^(nd), B_φ^(nd)) = -∇V^(nd)`

3. 等价差值形式
   - 在数值实现中，更简便的做法是先计算总主场，再减去偶极部分：

`B(r,θ,φ,t) = B^(1) + B^(nd)`

`B^(nd) = B - B^(1)`

   - 多数文章实际上采用这种“先算全场、再减去偶极”的实现方式，只要保证使用同一套高斯系数，结果与直接截断 `l ≥ 2` 完全一致。

## 4 非偶极子磁场各要素的计算公式

### 4.1 球坐标到地理坐标（NED）的转换

在 IGRF 中，球坐标与地理坐标的关系为：

- 球坐标 (r, θ, φ)：
  - θ：余纬度，北极为 0，南极为 π。
  - φ：地理经度，通常从本初子午线向东为正。

- 地理坐标分量（北 N、东 E、下 D）：
  - X：指向地理正北。
  - Y：指向地理正东。
  - Z：指向径向向下。

两者的关系为（IGRF 标准约定）：

`X = -B_θ, Y = B_φ, Z = -B_r`

对非偶极场同样有：

`X^(nd) = -B_θ^(nd)`

`Y^(nd) = B_φ^(nd)`

`Z^(nd) = -B_r^(nd)`

### 4.2 H、F、D、I 的计算

1. 水平强度 H：

   - `H = sqrt(X^2 + Y^2)`
   - `H^(nd) = sqrt( (X^(nd))^2 + (Y^(nd))^2 )`

2. 总场强度 F：

   - `F = sqrt(H^2 + Z^2)`
   - `F^(nd) = sqrt( (H^(nd))^2 + (Z^(nd))^2 )`

3. 磁偏角 D（由北向东为正）：

   - `D = atan2(Y, X)`
   - `D^(nd) = atan2( Y^(nd), X^(nd) )`

4. 磁倾角 I（向下为正）：

   - `I = atan2(Z, H)`
   - `I^(nd) = atan2( Z^(nd), H^(nd) )`

注意：

- 对于非偶极场，D、I 的物理含义相对全场略复杂，因为非偶极场未必近似偶极；但作为分析非偶极结构的几何量，仍然有用。

## 5 全球分布的计算流程

这一部分对应安振昌等关于 1900–2000 年非偶极子磁场全球变化的基本计算步骤，并结合 IGRF-13 扩展到更长时间。

### 5.1 计算网格设计

1. 空间范围
   - 选择地表球 `r = a`，`θ ∈ [0,π]`，`φ ∈ [0,2π)`。

2. 网格分辨率
   - 行星尺度结构（大尺度非偶极异常）：通常采用经纬度 2°×2° 或 5°×5° 网格即可。
   - 对南大西洋异常等细致研究：可采用 1°×1°，甚至更细。

3. 网格点坐标
   - 用纬度 φ 表示：`φ = 90° - θ`，`φ ∈ [-90°, 90°]`。
   - 对每个网格点，计算：
     - `θ = 90° - φ`（转换为弧度）。
     - `φ` 为经度（也转换为弧度）。

### 5.2 单历元非偶极场计算步骤

给定某一历元 t（例如 1950.0）和 IGRF 高斯系数：

1. 读取或内插高斯系数
   - 从 IGRF 系数文件中读取该历元的 `g_l^m(t)`、`h_l^m(t)`。
   - 若 t 在两个历元之间，则按 IGRF 规则对系数线性内插。

2. 预计算缔合勒让德函数
   - 对于每个网格点 θ，计算所有需要的 P_l^m(cosθ)（l = 1…L，m = 0…l）。
   - 为数值稳定与效率，通常采用递推算法。

3. 计算总主场分量 B
   - 按 3.1 的公式对 l = 1…L 逐阶累加，得到：
     - B_r(θ,φ)、B_θ(θ,φ)、B_φ(θ,φ)。

4. 计算偶极场分量 \(\mathbf{B}^{(1)}\)
   - 只取 l = 1，按同样的公式单独计算：
     - \(B_r^{(1)}, B_\theta^{(1)}, B_\phi^{(1)}\)。

5. 得到非偶极场分量 `B^(nd)`

   - `B_r^(nd) = B_r - B_r^(1)`
   - `B_θ^(nd) = B_θ - B_θ^(1)`
   - `B_φ^(nd) = B_φ - B_φ^(1)`

6. 转为 X、Y、Z 及各要素
   - 按 4.1、4.2 计算：
     - `X^(nd), Y^(nd), Z^(nd), H^(nd), F^(nd), D^(nd), I^(nd)`

7. 绘制全球分布图
   - 对 F、Z 或 H 等要素绘制等值线图或着色图：
     - 非偶极总场强度 \(F^{(nd)}\) 的全球等值线图。
     - \(Z^{(nd)}\) 或 \(B_r^{(nd)}\) 的全球等值线图，用于突出正负异常。
   - 按照文献做法，可重点标注 5 个主要磁异常区：
     - 东亚正异常（EA）。
     - 大洋洲负异常（AUS）。
     - 南大西洋正异常（SAT）。
     - 非洲负异常（AF）。
     - 北美正异常（NAM）。

### 5.3 不同高度的非偶极场

若需要分析核幔边界（CMB）或卫星高度的非偶极场：

1. 选定半径 r
   - CMB：`r_cmb ≈ 3485 km`。
   - 卫星高度：`r = a + h`（例如 `h = 400 km`）。

2. 将上述计算中的 \((a/r)^{l+1}\) 按新的 r 重算，其他步骤完全相同。

3. 对比地表与 CMB 非偶极场分布，可研究西向漂移在不同深度的差异（如行星尺度异常西漂速度在地表约 0.2°/a，在 CMB 小于 0.1°/a）。

## 6 非偶极子磁场时间变化的计算方法

### 6.1 多历元场的差分与长期变化率

对每个网格点 `(φ_i, λ_j)` 和历元 `t_k`：

1. 按 5.2 计算每个历元的非偶极场要素：
   - F^(nd)(i,j,k), H^(nd)(i,j,k), Z^(nd)(i,j,k) 等。

2. 计算时间差分（简单差分）

   - `ΔF^(nd)(i,j,k) = F^(nd)(i,j,k+1) - F^(nd)(i,j,k)`

   - 步长 `Δt = t_{k+1} - t_k = 5 a`

3. 计算长期变化率（平均年变化）

   - `Ḟ^(nd)(i,j,k) ≈ ΔF^(nd)(i,j,k) / Δt`

对 H、Z 等要素同理。用这种差分方法可以直接恢复安振昌等对 1900–2000 年间非偶极场强度变化的统计结论。

### 6.2 行星尺度磁异常强度：无符号磁通量

行星尺度异常强度不仅取决于局部极值，还与异常区面积和场分布形态有关。经典做法是使用“无符号磁通量”作为特征参数：

1. 异常区定义
   - 对某一历元，在全球 B_r^(nd) 或 Z^(nd) 场上，按符号和阈值划分异常区。
   - 例如，以 B_r^(nd)：
     - 东亚正异常：B_r^(nd) > B_thr > 0，位于东亚区域。
     - 大洋洲负异常：B_r^(nd) < -B_thr < 0，位于大洋洲附近。
   - 阈值 B_thr 可通过经验设定或按某一百分位数选择，以保证捕获行星尺度的大范围异常。

2. 无符号磁通量定义

对某一异常区 S，在半径 r 处定义：

- 连续形式：`Φ_S^(nd) = ∬_S |B_r^(nd)(θ,φ)| r^2 sinθ dθ dφ`

数值实现中：

- 在经纬度网格上，用离散求和近似积分：
  - `Φ_S^(nd) ≈ Σ_{(i,j)∈S} |B_r^(nd)(i,j)| r^2 sinθ_i Δθ Δφ`

- 单位：
  - 若 `B_r^(nd)` 用 nT，则转换为 T 以得到 SI 制下的韦伯（1 Wb = 1 T·m²）。
  - 经典地球物理文献常用 MWb（兆韦伯）表示。

3. 时间序列
   - 对每个历元 `t_k`，重复上述步骤，得到每个异常区的：
     - 磁通量 `Φ_S^(nd)(t_k)`。
     - 面积 `A_S(t_k)`（按网格面积求和）。
     - 极值强度 `|B_r^(nd)|_max(t_k)` 或 `F^(nd)_max(t_k)`。
   - 分析 1900–2000 或 1900–2020 间：
     - 哪些异常区磁通量增长最快（如非洲负异常、南大西洋正异常、大洋洲负异常等）。
     - 哪些异常区强度减弱（如北美异常磁通量的减小）。

### 6.3 异常中心位置与西向漂移

要研究非偶极子场的西向漂移，关键是对行星尺度异常中心位置做时间跟踪。

1. 局部极值点法
   - 在每个异常区 S 上搜索：
     - F^(nd) 的最大值或最小值位置。
     - 或 B_r^(nd) 的极值位置。
   - 记该点的地理坐标为 (φ_c(t_k), λ_c(t_k))，作为异常中心。

2. 加权质心法
   - 为降低局部噪声，可采用磁通量加权质心：

   - `x_c = ( Σ_{(i,j)∈S} w_ij cosφ_i cosλ_j ) / Σ_{(i,j)∈S} w_ij`
   - `y_c = ( Σ_{(i,j)∈S} w_ij cosφ_i sinλ_j ) / Σ_{(i,j)∈S} w_ij`
   - `z_c = ( Σ_{(i,j)∈S} w_ij sinφ_i ) / Σ_{(i,j)∈S} w_ij`

   - 其中权重可取：

   - `w_ij = |B_r^(nd)(i,j)| r^2 cosφ_i Δφ Δλ`

   - 然后归一化 `(x_c, y_c, z_c)` 并反算为 `(φ_c, λ_c)`。

3. 西向漂移速度
   - 将异常中心的经度随时间拟合为线性关系：

   - `λ_c(t) ≈ λ_0 + ω (t - t_0)`

   - 其中 `ω` 为经度变化速率（度/年）。

   - 将 `ω` 换算为线速度：

   - `v = |ω| × (π / 180°) × R_φ`

   - 其中 `R_φ = a cosφ_c` 为该纬度处的地球半径投影，`v` 单位约为 `km/a`。

   - 文献表明：
     - 地表行星尺度异常的平均西漂速度约 0.2°/a。
     - 在核幔边界的平均西漂速度小于 0.1°/a，反映不同球谐阶次在深部的漂移差异。

### 6.4 各要素时间变化的剖面与时空演化

除了对异常区整体强度进行时间分析，还可以对每个要素构造剖面和演化图：

1. 纬向或经向剖面
   - 选取某一固定纬度或经度，对 F^(nd)、Z^(nd) 随经度（或纬度）的分布进行 1900–2020 年的对比。
   - 可直观看到异常区强度和位置如何随时间变化。

2. 时空演化图
   - 对某一选定区域（例如南大西洋 60°W–20°E，纬度 -60°–0°），绘制：
     - 时间–经度（或时间–纬度）剖面图，色标为 F^(nd) 或 Z^(nd)。
   - 由此可读出异常的漂移轨迹和扩展/收缩过程。

3. 各要素之间的耦合关系
   - 比较 \(F^{(nd)}\)、\(Z^{(nd)}\)、\(H^{(nd)}\) 的变化：
     - 南大西洋异常等区域中，\(F^{(nd)}\) 减弱往往与 \(Z^{(nd)}\) 的变化高度相关。
   - 可进一步分析非偶极子场在不同要素中的能量分配。

## 7 区域研究与中国地区非偶极场分析（简要）

目录中的部分论文针对中国区域（例如冠谐分析 2000 年中国地磁场及其长期变化等），其基本思路为：

1. 区域数据与模型
   - 使用 IGRF 提供的全球主场作为背景，再结合中国地磁台站或测线数据，对区域场进行精细建模。
   - 区域建模可采用：
     - 多项式拟合。
     - 球冠谐函数（spherical cap harmonics）等。

2. 非偶极场获取
   - 先从 IGRF 或区域模型中计算总场要素 X、Y、Z。
   - 再在同一时刻计算偶极场（l = 1）对应的 X、Y、Z。
   - 相减得到区域非偶极场要素。

3. 区域长期变化
   - 对中国区域网格上的 \(X^{(nd)}, Y^{(nd)}, Z^{(nd)}, F^{(nd)}\) 做逐年或逐历元差分。
   - 分析：
     - 非偶极场在中国的增强/减弱区域。
     - 与全球行星尺度异常（如东亚正异常）的对应关系。

这一区域方法在技术上与全球方法完全一致，只是在空间域和建模细节上更精细。

## 8 南大西洋异常与强非偶极场的长期持续性

结合近年的工作（如基于 IGRF12/IGRF13 的南大西洋异常研究）以及早期关于 1900–2000 年非偶极场的结果，可以将南大西洋异常视为一类典型的强非偶极场结构，其定量描述方法包括：

1. 区域定义
   - 在南美–南大西洋–南非附近，找到 \(F\) 全场的极小值区域。
   - 计算对应的非偶极场 \(F^{(nd)}\)、\(B_r^{(nd)}\)，分析非偶极场在其中的贡献比例。

2. 强度与面积
   - 使用同样的无符号磁通量和面积计算方法（6.2）。
   - 对比 1900–2000 与 2000–2020 两个阶段：
     - 分析南大西洋异常的进一步增强和东西向扩展。

3. 中心轨迹与多中心结构
   - 早期南大西洋异常可视为单一极小值中心。
   - 近几十年研究表明，该区域可能演化出“多中心”结构：
     - 可分别计算每个局部极小值的轨迹。
     - 比较其经向、纬向漂移速度。

4. 非偶极场能量占比
   - 在南大西洋区域，比较非偶极场与全场的能量：
     - 定义局部能量密度 \(E \propto |\mathbf{B}|^2\)。
     - 计算非偶极场和全场的比值 \(E^{(nd)}/E\)。
   - 若非偶极场在该区域占比较高，说明其结构主要由高阶球谐分量控制，这与“强非偶极磁场的长期持续性”观点相一致。

## 9 实际实现建议（数值与程序层面）

1. 使用官方或权威 IGRF 函数库
   - IGRF 官方提供 Fortran 例程，社区中已有 MATLAB、Python 等移植版本。
   - 建议：
     - 先调用现成函数计算总场 X、Y、Z。
     - 自行实现“只保留 l = 1”或“只保留 l ≥ 2”的球谐求和，以便获得偶极场和非偶极场。

2. 精度与截断阶数
   - 对行星尺度研究，l ≤ 10–13 已足够。
   - 若只关心更大尺度结构，可以选择更低的 L（例如 L = 8），以减少高阶噪声。

3. 数值稳定性
   - 高阶 \(P_l^m\) 在高纬度可能存在数值不稳定，需使用稳定的递推算法。
   - 注意不同库对 \(P_l^m\) 归一化方式的约定要与 IGRF 系数一致（Schmidt 半正规化）。

4. 单位与坐标系
   - 统一使用：
     - B 单位：nT（或 T）。
     - r、a：km（或 m），在计算磁通量时务必转换一致。
   - 确认所用 IGRF 代码的经度方向（通常为东经为正）与自身坐标系统一致。

5. 结果验证
   - 在某一典型历元（如 2000.0）：
     - 检查全场 F 的全球分布是否与 IGRF 发布的标准图一致。
     - 检查偶极场是否近似轴对称，且在磁赤道附近 F 最小，在极区最大。
     - 检查非偶极场是否在东亚、南大西洋等区域出现明显异常，与文献给出的结构 qualitatively 一致。

## 10 小结：从论文到统一方法论

综合各篇文献，可以将非偶极子磁场各要素的全球分布及其时间变化计算方法概括为：

1. 使用 IGRF 提供的主磁场高斯系数，以球谐展开形式在全球网格上计算主场分量。
2. 将 l = 1 的偶极项单独求和，得到偶极场；用“主场减去偶极场”的方式获得非偶极场。
3. 在地表或任意半径上，将非偶极场从球坐标转换为地理坐标，进而得到 X、Y、Z、H、F、D、I 等所有要素的非偶极分量。
4. 通过多历元差分与时间序列分析，刻画非偶极场要素在 20 世纪乃至更长时间内的长期变化。
5. 采用“无符号磁通量 + 面积 + 极值 + 中心位置”四个指标，对东亚、大洋洲、南大西洋、非洲、北美等行星尺度磁异常进行定量描述，并由此研究其强度演化与西向漂移。
6. 在区域尺度（如中国）上重复上述框架，只是数据与模型更精细，从而把全球非偶极场研究与区域长期变化联系起来。

按本方法论实现，即可系统、统一地再现并扩展目录中各论文关于非偶极子磁场全球分布及其时间演化的主要结论。

